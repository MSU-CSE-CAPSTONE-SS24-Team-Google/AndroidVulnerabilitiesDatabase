<!--
   This the HTML code that shows all of the important details about a vulnerability 
    Author: Trey Cosnowski, Alex Bocchi
-->

<div class="container">
    <div class = "chartcontainer" *ngIf="vulnerabilitiesLength != 0">

        <canvas #bsChart baseChart 
            [datasets]="CVSSData.bsdata"
            [labels]="CVSSData.labels"
            [type]="'doughnut'"
            [options] = "BSOptions"
            >
        </canvas>
    

        <canvas #esChart baseChart 
            [datasets]="CVSSData.esdata"
            [labels]="CVSSData.labels"
            [type]="'doughnut'"
            [options] = "ESOptions"
            >
        </canvas>

        <canvas #esChart baseChart 
            [datasets]="CVSSData.isdata"
            [labels]="CVSSData.labels"
            [type]="'doughnut'"
            [options] = "ISOptions"
            >
        </canvas>
    </div>




    <div class="vulnerability-list"  *ngIf="vulnerabilitiesLength != 0; else noResult">
        
        <div *ngFor="let vulnerability of currentTablePage()" class="vulnerability-card" >
        <div (click)="goToDetailsPage(vulnerability)">
            <mat-card  class="mat-elevation-z2" >
                
                <mat-card-header  [class.critical]="vulnerability.severity === 'Critical'" [class.high]="vulnerability.severity === 'High'" [class.moderate]="vulnerability.severity === 'Moderate'" [class.low]="vulnerability.severity === 'Low'">
                    <mat-card-title>{{ vulnerability.cve }}</mat-card-title>
                    <div class="severity-item">
                    <mat-progress-spinner
                    mode="determinate"
                    [value]="vulnerability.base_score * 10"
                    [color]="getSeverityColor(vulnerability.base_score)"
                    diameter="100"
                    strokeWidth="10"
                    ></mat-progress-spinner>
                    <div class="severity-label" *ngIf="vulnerability.base_score != null"><strong>{{ vulnerability.base_score }}</strong></div>
                    <div class="severity-label" *ngIf="vulnerability.base_score != null">Base Score</div>
                </div>
                </mat-card-header>

            
                <mat-card-content  [class.critical]="vulnerability.severity === 'Critical'" [class.high]="vulnerability.severity === 'High'" [class.moderate]="vulnerability.severity === 'Moderate'" [class.low]="vulnerability.severity === 'Low'">
                    <div class="vulnerability-info" >
                        <div class="label">Patch Level:</div>
                        <div class="value">{{ vulnerability.patch_level }}</div>
                        <div class="label">Severity:</div>
                        <div class="value">{{ vulnerability.severity }}</div>
                        <div class="label">Type:</div>
                        <div class="value">{{ vulnerability.type }}</div>
                        <div class="label">Refrences:</div>
                        <div class="value">{{ vulnerability.references_ }}</div>
                        <div class="label">Component:</div>
                        <div class="value">{{ vulnerability.component }}</div>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>
    </div>

    <ng-template #noResult><h2>No Vulnerabilities Meet the Search Parameters </h2></ng-template>

    <div *ngIf="vulnerabilitiesLength > 20">
        <button mat-icon-button (click)="prevPage()" [disabled]="!hasPrevPage()"><mat-icon>keyboard_arrow_left</mat-icon></button>
        <button mat-icon-button (click)="nextPage()" [disabled]="!hasNextPage()"><mat-icon>keyboard_arrow_right</mat-icon></button>
      </div>
      <p>Page {{currentPage + 1}} of {{totalPages + 1}}</p>
</div>