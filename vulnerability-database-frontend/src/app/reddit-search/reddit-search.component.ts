import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RedditService } from '../reddit.service';
import { FormsModule } from '@angular/forms';

@Component({
  selector: 'app-reddit-search',
  standalone: true,
  imports: [CommonModule, FormsModule],
  templateUrl: './reddit-search.component.html',
  styleUrl: './reddit-search.component.css'
})
export class RedditSearchComponent {


  keyword: string;
  subreddit: string = 'android'; 
  searchResults: any;

  postTitles : string = '';
  //list of subreddits that someone might want to search if they are using our web app
  subreddits: string[] = ['android', 'googlepixel', 'androiddev', 'tech', 'all', 'Custom'];
  customSubreddit = '';


  constructor(private redditService: RedditService) { }

search(): void {
  
  if (this.subreddit === 'Custom') 
  {
    this.subreddit = this.customSubreddit;
  }
  this.redditService.searchSubreddit(this.keyword, this.subreddit).subscribe(data => {

      this.searchResults = data.data.children.filter((post: any) => {

          //selftext refers the main body of the post
          //statements to check if the selftext or the title contains relevant terms
          const titleContainsCVE = post.data.title.toLowerCase().includes('cve');
          const selftextContainsCVE = post.data.selftext.toLowerCase().includes('cve');
          const titleContainsAndroid = post.data.title.toLowerCase().includes('android');
          const selftextContainsAndroid = post.data.selftext.toLowerCase().includes('android');
          const selftextContainsPixel = post.data.selftext.toLowerCase().includes('pixel');
          const selftextContainsNexus = post.data.selftext.toLowerCase().includes('nexus');
          const titleContainsPixel = post.data.title.toLowerCase().includes('pixel');
          const titleContainsNexus = post.data.title.toLowerCase().includes('nexus');

          
          //a logical statement to check if the selftext and title contain relevant terms
          // it should check if the post contains the words cve in the title or self text
          // and a relevant os / device platform in the self text or title
          return (selftextContainsCVE && selftextContainsAndroid)|| (selftextContainsCVE && titleContainsAndroid) 
          || (selftextContainsAndroid && titleContainsCVE) || 
          (titleContainsCVE && titleContainsAndroid) || (selftextContainsPixel && selftextContainsCVE)
          || (selftextContainsNexus && selftextContainsCVE) || (selftextContainsNexus && titleContainsCVE) ||
          (selftextContainsPixel && titleContainsCVE) || (titleContainsNexus && selftextContainsCVE) || (titleContainsPixel && selftextContainsCVE);
      });
      //doing this so that when the user selects custom and searches, the dropdown saves what the user has entered.
      if (this.subreddit === this.customSubreddit) {
        this.subreddit = 'Custom';
      }
      console.log(this.searchResults);
  });
}

}
